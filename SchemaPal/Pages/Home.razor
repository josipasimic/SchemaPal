@page "/"

@using SchemaPal.PageComponents.HomePageComponents;
@using SchemaPal.Services;

@inject NavigationManager _navigationManager
@inject IUserSessionService _userSessionService

<PageTitle>SchemaPal</PageTitle>

<div class="home-grid">
    <div class="sidebar">
        <h3>Glavni izbornik</h3>
        <ul class="nav-buttons">
            <li class="@(currentView == ViewType.NewSchema ? "selected" : string.Empty)" @onclick="ShowNewSchema">Izradi novu shemu</li>
            <li class="@(currentView == ViewType.TemplateSchemas ? "selected" : string.Empty)" @onclick="ShowTemplateSchemas">Izradi shemu iz predloška</li>
            @if (isLoggedInUser)
            {
                <li class="@(currentView == ViewType.MySchemas ? "selected" : string.Empty)" @onclick="ShowMySchemas">Moje sheme</li>
            }
            <li class="@(currentView == ViewType.ImportSchema ? "selected" : string.Empty)" @onclick="ShowImportSchema">Uvezi shemu</li>
        </ul>
    </div>
    <div class="main-content">
        @if (currentView == ViewType.NewSchema)
        {
            <button @onclick="OpenSchemaMakerCanvas">+</button>
            <h3>Izradi novu shemu</h3>
        }
        else if (currentView == ViewType.TemplateSchemas)
        {
            <TemplateSchemas />
        }
        else if (currentView == ViewType.MySchemas)
        {
            <MySchemas />
        }
        else if (currentView == ViewType.ImportSchema)
        {
            <ImportSchema />
        }
    </div>
</div>

@code {
    private enum ViewType { NewSchema, TemplateSchemas, MySchemas, ImportSchema }
    private ViewType currentView = ViewType.NewSchema;
    private bool isGuest = false;
    private bool isLoggedInUser = false;

    protected override async Task OnInitializedAsync()
    {
        isGuest = await _userSessionService.IsUserGuest();
        isLoggedInUser = await _userSessionService.IsUserLoggedIn();

        if (!isGuest 
            && !isLoggedInUser)
        {
            _navigationManager.NavigateTo("/login-redirect");
        }
    }

    private void ShowNewSchema() => currentView = ViewType.NewSchema;
    private void ShowTemplateSchemas() => currentView = ViewType.TemplateSchemas;
    private void ShowMySchemas() => currentView = ViewType.MySchemas;
    private void ShowImportSchema() => currentView = ViewType.ImportSchema;

    private void OpenSchemaMakerCanvas()
    {
        _navigationManager.NavigateTo("/schema-maker");
    }
}
